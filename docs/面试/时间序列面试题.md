

## **AR模型**

自回归模型根据历史观测值进行预测
$$
x_{t}=\phi_{0}+\phi_{1} x_{t-1}+\ldots+\phi_{p} x_{t-p}+\epsilon_{t}
$$
其中，$\phi_{p}$是预测误差，$\epsilon_{t}$为回归系数。



## **MA模型**

当前时刻的时序值是过去 q 阶白噪声的线性组合
$$
x_{t}=\theta_{0}+\theta_{1} \epsilon_{t-1}+\theta_{2} \epsilon_{t-2}+\ldots+\theta_{q} \epsilon_{t-q}+\epsilon_{t}
$$

$$
\text { 其中, } \epsilon_{t-1}, \epsilon_{t-2}, \ldots, \epsilon_{t-p} \text { 为前 } q \text { 期的随机扰动项},\\
\text { 误差项是当前期的随机干扰 } \epsilon_{t} \text { (零均值白噪声序列)， } \\ \theta_{i} \text { 为平滑系数。 }
$$

## **ARMA 模型**

混合模型为同时包含AR模型和MA模型。
$$
x_{t}=\phi_{0}+\phi_{1} x_{t-1}+\phi_{2} x_{t-2}+\ldots+\phi_{p} x_{t-p}+\theta_{1} \epsilon_{t-1}+\theta_{2} \epsilon_{t-2}+\ldots+\theta_{q} \epsilon_{t-q}+\epsilon_{t}
$$
**一个随机时间序列可以通过一个自回归移动平均模型来表示，即该序列可以由其自身的过去或滞后值以及随机扰动项来解释。**

**如果该序列是平稳的，即它的行为并不会随着时间的推移而变化，那么我们就可以通过该序列过去的行为来预测未来。**

AR模型有偏自相关函数截尾性质，MA模型有自相关函数截尾性质。ARMA模型结合了AR和MA模型，在对数据拟合优度相近的情况下往往可以得到更好的模型，而且不要求偏自相关函数截尾也不要求自相关函数截尾。



## **ARIMA 模型**

将自回归模型(AR)、移动平均模型(MA)和差分法结合，我们就得到了差分自回归移动平均模型 ARIMA(p、d、q)，其中 d 是需要对数据进行差分的阶数，差分的主要目的是使数据平稳。



## 使用ARMA模型时，如何进行定阶？

- 对序列绘图，进行 ADF 检验，观察序列是否平稳，对于非平稳时间序列要先进行 d 阶差分，转化为平稳时间序列；
- 对平稳时间序列分别求得其自相关系数（ACF）和偏自相关系数（PACF），通过对自相关图和偏自相关图的分析，得到最佳的阶数p、q；
- 根据得到的d、q、p ，得到 ARIMA 模型。然后开始对得到的模型进行模型检验。
- 最优信息准则(AIC,BIC)选择p、q，筛选策略为尽可能选择更简单的模型 

## ARIMA变种

ARIMAX



## ADF检验

**ADF检验**，也叫做**单位根检验**，ADF是 Dickey-Fuller检验的增广形式。DF检验只能应用于一阶情况，当序列存在高阶的滞后相关时，可以使用ADF检验，所以说ADF是对DF检验的扩展。

当一个自回归过程中：$y_{t}=b y_{t-1}+a+\epsilon_{t}$ ，如果滞后项系数b为1，就称为单位根。当单位根存在时，自变量和因变量之间的关系具有欺骗性，因为残差序列的任何误差都不会随着样本量（即时期数）增大而衰减，也就是说模型中的残差的影响是永久的。这种回归又称作伪回归。如果单位根存在，这个过程就是一个随机漫步（random walk）。

**如果序列平稳，就不存在单位根；否则，就会存在单位根。**ADF检验的 H0 假设就是存在单位根，如果得到的显著性检验统计量小于三个置信度（10%，5%，1%），则对应有（90%，95，99%）的把握来拒绝原假设。

## ADF检验流程

- ADF检验，如果序列平稳，则不存在单位根，否则就会存在单位根。
- 若数据不平稳，则可以做差分变换，查看是否差分后平稳。
- ADF原假设为，序列存在单位根，即非平稳，对于一个平稳的时序数据，就需要在给定的置信水平上显著，拒绝原假设。
- 若得到的统计量显著小于3个置信度（1%，5%，10%）的临界统计值时，说明是拒绝原假设的。另外是看P-value是否非常接近0.（4位小数基本即可）

### ADF检验的python实现

```
from statsmodels.tsa.stattools import adfuller
```

```
adfuller函数的参数意义分别是：

x：一维的数据序列。
maxlag：最大滞后数目。
regression：回归中的包含项（c：只有常数项，默认；ct：常数项和趋势项；ctt：常数项，线性二次项；nc：没有常数项和趋势项）
autolag：自动选择滞后数目（AIC：赤池信息准则，默认；BIC：贝叶斯信息准则；t-stat：基于maxlag，从maxlag开始并删除一个滞后直到最后一个滞后长度基于 t-statistic 显著性小于5%为止；None：使用maxlag指定的滞后）
store：True  False，默认。
regresults：True 完整的回归结果将返回。False，默认。
返回值意义为：

adf：Test statistic，T检验，假设检验值。
pvalue：假设检验结果。
usedlag：使用的滞后阶数。
nobs：用于ADF回归和计算临界值用到的观测值数目。
icbest：如果autolag不是None的话，返回最大的信息准则值。
resstore：将结果合并为一个dummy。
```

```
result = adfuller(rb_price)
print(result)
 
 
(-0.45153867687808574, 
0.9011315454402649, 
1, 
198, 
{'5%': -2.876250632135043, '1%': -3.4638151713286316, '10%': -2.574611347821651}, 1172.4579344852016)

```

## 构建ARIMA模型流程？

![图片](img/ARIMA/640)

1. ADF检验：查看p-value，如果p-value大于0.05，表明序列非平稳，需要进行差分
2. 白噪声检验：检验差分后的数据是否为白噪声，各滞后期数下p值都为0均小于0.05，差分后的序列非白噪声，可以进行预测
3. 模型定阶：
   1. 绘制 ACF和PACF图，确定p、q
   2. 最优信息准则(AIC,BIC)选择最优p、q，筛选策略为尽可能选择更简单的模型 
4. 模型训练：观察系数p值，如果均小于0.05，说明系数均显著不为0。如果存在某个系数的p值较大，说明t检验中系数不显著，贡献不大，可以剔除，减小模型冗余度。
5. 模型检验：可视化残差直方图、QQ图，看是否正态分布，可视化ACF看是否仍存有自相关性
6. 模型预测：ARMA模型预测时，预测期数超过MA模型最大阶数后，MA部分的预测值实际为序列均值不再变化，AR部分倒还会有持续变化但效果下降
7. 差分还原：把曾经减去的项再加回来


## 参考资料
[时间序列分析ARIMA 模型 ](https://zhuanlan.zhihu.com/p/60648709)

[时间序列：ARMA 应用指南](https://mp.weixin.qq.com/s/LR9NJKbW54lUjGcLmWuV1Q)