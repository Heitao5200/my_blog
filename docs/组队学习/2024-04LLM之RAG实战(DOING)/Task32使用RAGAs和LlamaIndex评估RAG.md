## RAG评估指标

RAG的有效性可以通过测量这些三元组之间的相关性来评估

<img src="img/Task32使用RAGAs和LlamaIndex评估RAG/640" alt="Image" style="zoom:50%;" />



- **RAG评估指标**:
  - **可信度（Faithfulness）**: 确保答案基于给定上下文生成。
  - **答案相关性（Answer Relevance）**: 生成答案和查询之间的相关性。
  - **上下文相关性（Context Relevance）**: 检索到的上下文支持查询的程度。
  - **上下文精度（Context Precision）**: 检索到的包含真实事实的所有相关上下文是否排名靠前。
  - **上下文召回（Context Recall）**: 检索到的上下文和标注答案之间的一致性水平。

## 评估方法
- **可信度评估**:
  
  - 对于避免幻觉和确保检索到的上下文可以用作生成答案是非常重要的。如果得分较低，则表明LLM的响应不符合检索到的知识，这样提供幻觉答案的可能性增加
  
  - 使用LLM提取语句并验证这些语句是否可以从上下文中推断出来。
  
  - 可信度分数计算公式如下，其中$|V|$是LLM支持的语句数，$|S|$是语句总数。
    $$
    F = \frac{|V|}{|S|}
    $$
    
  
- **答案相关性评估**:

  - 答案相关性衡量的是生成答案和查询之间的相关性

    ![Image](img/Task32使用RAGAs和LlamaIndex评估RAG/640-20240402091311653)

  - 得分越高表示相关性越好

  - 基于给定答案生成潜在问题，并使用文本嵌入模型计算问题的相似性。

- **上下文相关性评估**:

  - ![Image](img/Task32使用RAGAs和LlamaIndex评估RAG/640-20240402091339189)
  - 使用LLM从上下文中提取关键句子，并对这些句子进行相关性评分。

- **上下文召回和精度评估**:

  - ![Image](img/Task32使用RAGAs和LlamaIndex评估RAG/640-20240402091350046)
  - 需要提供标注数据集，使用基本事实和检索到的上下文进行计算。

- **上下文精度**

  - ![Image](img/Task32使用RAGAs和LlamaIndex评估RAG/640-20240402091425501)
  - 用于衡量检索到的包含真实事实的所有相关上下文是否排名靠前。分数越高表示精度越高。
  - **缺点**：如果相关召回很少，但都排名很高，那么分数也会很高


## 使用RAGAs+LlamaIndex进行RAG评估

![Image](img/Task32使用RAGAs和LlamaIndex评估RAG/640-20240402091510118)

- **环境配置**:
  - 使用pip安装ragas，并检查版本。
  - 导入相关库，设置环境和全局变量。
- **构建RAG查询引擎**:
  - 使用LlamaIndex构建查询引擎，配置LLM和嵌入模型。
- **评估数据集构建**:
  - 准备问题和答案的示例数据集。
- **指标选择和RAGA评估**:
  - 选择适当的评估指标进行RAG系统评估。
- **最终代码**:
  - 提供了完整的代码示例，用于执行评估并输出结果。