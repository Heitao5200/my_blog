## **高级RAG**

<img src="img/Task37高级RAG从理论到LlamaIndex实现/640-20240405205452398" alt="Image" style="zoom: 25%;" />

### **预检索优化**

预检索优化侧重于数据索引优化和查询优化。数据索引优化技术旨在提高存储数据的检索效率，例如：

- 滑动窗口使用块之间的重叠，是最简单的技术之一。
- 增强数据粒度应用数据清理技术，如删除无关信息、确认事实准确性、更新过时信息等。
- 添加元数据，可以过滤如日期、目的或章节等信息。
- 优化索引结构涉及到对数据进行索引的不同策略，例如调整块大小或使用多索引策略。我们将在本文中实现的一种技术是句子窗口检索，它使用单个嵌入句子进行检索，并在推理时用更大的文本窗口替换它们。

预检索技术并不局限于数据索引，还可以涵盖推理时的技术，如查询路由、查询重写和查询扩展

### **检索优化**

检索阶段旨在识别最相关的上下文。通常，检索是基于向量搜索的，向量搜索计算查询和索引数据之间的语义相似性。因此，大多数检索优化技术都围绕着嵌入模型[1]：

- - 微调嵌入模型可根据特定领域的上下文定制嵌入模型，尤其是对于具有不断演变或罕见术语的领域。例如，BAAI/bge-small-en是一种可以微调的高性能嵌入模型（请参阅微调指南[1]）。
  - 动态嵌入会根据上下文使用的单词动态给出每个单词的向量，而静态嵌入则为每个单词使用一个向量。例如，OpenAI的embeddings—da-02是一个复杂的动态嵌入模型，可以捕捉上下文理解。



> 除了矢量搜索之外，还有其他检索技术，例如混合搜索，是指将矢量搜索与基于关键字的搜索相结合。如果您的检索需要精确的关键字匹配，那么混合搜索是非常合适的。

### **检索后优化**

​    有时候需要对检索到的上下文进行额外的处理，比如检索到的内容超出上下文窗口限制或引入了噪声之类的问题。下面介绍一些检索后处理技术：

- - 提示压缩通过删除不相关的上下文并突出显示重要上下文来减少整个提示长度。
  - 重新排序使用机器学习模型来重新计算检索到的上下文的相关性得分。

![Image](img/Task37高级RAG从理论到LlamaIndex实现/640-20240405205918667)

